<md-card *ngIf="delivery" class="app-input-section">
  <md-card-subtitle *ngIf="delivery.quantity">{{delivery.quantity}} entities from {{delivery.supplier}}
  </md-card-subtitle>
  <md-card-title>{{delivery.carrier || "New Delivery"}}</md-card-title>
  <form (ngSubmit)="updateDelivery.emit(delivery)"
    #deliveryDetailForm="ngForm">
    <md-card-content>
      <md-tab-group [selectedIndex]="selectedTabIndex">
        <md-tab label="Status">
          <md-list>
            <h3 md-subheader>Factory</h3>
            <md-list-item>
              <div md-line class="flex-container" fxLayout="row">
                <md-checkbox class="form-control" [checked]="delivery.status.isRegistered"
                  (change)="openSnackBar(delivery); delivery.status.setRegistered(); setValidity()"
                  name="delivery.status.isRegistered">
                  <span>{{delivery.status.registrationMessage}}</span>
                </md-checkbox>
                <md-checkbox class="form-control" [checked]="delivery.status.isProcessed"
                  (change)="delivery.status.setProcessed(); setValidity()"
                  name="delivery.status.isProcessed">
                  <span>{{delivery.status.processingMessage}}</span>
                </md-checkbox>
              </div>
            </md-list-item>
            <div *ngFor="let yardDelivery of delivery.activeYardDeliveries">
              <h3 md-subheader>{{yardDelivery.yard.name}}</h3>
              <md-list-item>
                <div md-line class="flex-container" fxLayout="row">
                  <md-checkbox class="form-control" [checked]="yardDelivery.status.isRegistered"
                    (change)="yardDelivery.status.setRegistered(); setValidity()"
                    name="yardDelivery.status.isRegistered">
                    <span>{{yardDelivery.status.registrationMessage}}</span>
                  </md-checkbox>
                  <md-checkbox class="form-control" [checked]="yardDelivery.status.isProcessed"
                    (change)="yardDelivery.status.setProcessed(); setValidity()"
                    name="yardDelivery.status.isProcessed">
                    <span>{{yardDelivery.status.processingMessage}}</span>
                  </md-checkbox>
                </div>
              </md-list-item>
            </div>
          </md-list>
        </md-tab>
        <md-tab label="Yards">
          <div class="flex-container" fxLayout="column">
            <md-input-container *ngFor="let yardDelivery of delivery.yardDeliveries">
              <input mdInput class="form-control" type="number"
                [min]="0" [(ngModel)]="yardDelivery.quantity"
                name="quantity {{yardDelivery.yard.name}}"
                placeholder="Quantity {{yardDelivery.yard.name}}">
            </md-input-container>
          </div>
        </md-tab>
        <md-tab label="Details" class="flex-container">
          <div class="flex-container" fxLayout="column">
            <md-input-container>
              <input mdInput class="form-control" placeholder="Carrier"
                required [newDeliveryFocus]="newDeliveryFocusEventEmitter"
                [(ngModel)]="delivery.carrier"
                name="carrier">
            </md-input-container>
            <md-input-container>
              <input mdInput class="form-control" placeholder="Supplier"
                required [(ngModel)]="delivery.supplier"
                name="supplier">
            </md-input-container>
          </div>
        </md-tab>
        <div *ngIf="delivery.deviations.length">
          <md-tab label="Deviations">
            <md-list-item *ngFor="let deviation of delivery.deviations">
              <app-deviation [selectedDeviation]="deviation"
                [deviations]="delivery.deviations"
                [deviationTypes]="deviationTypes">
              </app-deviation>
            </md-list-item>
            <div class="flex-container" fxLayout="row"
              fxLayoutAlign="end">
              <button type="button" (click)="addDeviation()"
                md-button><md-icon>add</md-icon></button>
            </div>
          </md-tab>
        </div>
      </md-tab-group>
    </md-card-content>
    <md-card-actions>
      <button type="submit" [disabled]="!deliveryDetailForm.form.valid || !statusIsValid"
        md-button>Submit</button>
      <button *ngIf="!delivery.deviations.length"
        type="button" (click)="addDeviation()"
        md-button>Add Deviation</button>
      <button type="button" (click)="removeDelivery.emit(delivery)"
        md-button><md-icon>delete</md-icon></button>
    </md-card-actions>
  </form>
</md-card>